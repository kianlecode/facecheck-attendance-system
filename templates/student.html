<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Trang sinh viÃªn</title>
  <link rel="icon" href="static\img\neu-logo.png" type="image/x-icon">
  <link rel="stylesheet" href="/static/style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet"/>
  <script src="/static/js/utils.js" defer></script>
  <script src="/static/js/student.js" defer></script>
</head>
<body>
  <div class="student-wrapper">
    <div class="student-layout">
      <!-- Sidebar -->
      <div class="student-sidebar">
        <h2>Sinh viÃªn</h2>
        <ul>
          <li><a href="#" class="active" data-section="attendance" onclick="showSection('attendance')">Äiá»ƒm danh</a></li>
          <li><a href="#" data-section="classes" onclick="showSection('classes')">Lá»›p há»c pháº§n</a></li>
          <li><a href="#" data-section="notifications" onclick="showSection('notifications')">ThÃ´ng bÃ¡o <span id="notif-badge" class="notif-badge"></span></a></li>
          <li><a href="#" data-section="info" onclick="showSection('info')">ThÃ´ng tin tÃ i khoáº£n</a></li>
          <li class="mt-4"><a href="#" class="logout-button" onclick="showModalLogout()">ÄÄƒng xuáº¥t</a></li>
        </ul>
      </div>

      <!-- Main content -->
      <div class="student-main">
        <h1>Xin chÃ o, <span id="student-name">Sinh viÃªn</span></h1>

        <!-- Section: Äiá»ƒm danh -->
        <section id="section-attendance">
          <p>Nháº¥n vÃ o nÃºt bÃªn dÆ°á»›i Ä‘á»ƒ thá»±c hiá»‡n Ä‘iá»ƒm danh:</p>
          <a href="/attendance.html" class="btn mt-2">Báº¯t Ä‘áº§u Ä‘iá»ƒm danh</a>
        </section>

        <!-- Section: Lá»›p há»c pháº§n -->
        <section id="section-classes" style="display: none;">
          <div class="tab-bar">
            <button class="tab-button" data-tab="list" onclick="switchClassTab('list')">Lá»›p Ä‘Ã£ Ä‘Äƒng kÃ½</button>
            <button class="tab-button active" data-tab="enroll" onclick="switchClassTab('enroll')">Tham gia lá»›p</button>
          </div>

          <div id="class-tab-list" style="display: none;">
            <div class="filter-bar">
              <input type="text" id="student-class-search" placeholder="ğŸ” TÃ¬m theo mÃ£ hoáº·c tÃªn lá»›p...">
            </div>
            <div id="registered-classes-wrapper">
              <div id="registered-classes" class="class-grid"></div>
              <div id="studentPagination" class="pagination-bar"></div>
            </div>
          </div>

          <div id="class-tab-enroll">
            <form id="enroll-form" class="mb-4">
              <label for="enroll-class-id">MÃ£ lá»›p:</label>
              <input type="text" id="enroll-class-id" placeholder="VD: CNTT63B" required />
              <label for="enroll-class-key">MÃ£ Ä‘Äƒng kÃ½:</label>
              <div class="password-input-wrapper">
                <input type="password" id="enroll-class-key" placeholder="Máº­t kháº©u lá»›p náº¿u cÃ³" required />
                <button type="button"
                        class="password-toggle-button"
                        onmousedown="showClassKey()"
                        onmouseup="hideClassKey()"
                        onmouseleave="hideClassKey()">
                  ğŸ‘
                </button>
              </div>
              <button type="submit" class="btn mt-2">ÄÄƒng kÃ½</button>
              <p id="enroll-message" class="mt-2"></p>
            </form>
          </div>
        </section>  

        <section id="section-notifications" style="display: none;">
          <h2>ThÃ´ng bÃ¡o</h2>
          <ul id="notificationList" class="notification-list"></ul>
        </section>

        <!-- Section: ThÃ´ng tin tÃ i khoáº£n -->
        <section id="section-info" style="display: none;">
          <h2>ThÃ´ng tin tÃ i khoáº£n</h2>
          <div id="account-info">
            <!-- pháº§n thÃ´ng tin vÃ  form chá»‰nh sá»­a sáº½ Ä‘Æ°á»£c student.js render vÃ o Ä‘Ã¢y -->
          </div>
        </section>      
      </div>
    </div>
  </div>

  <!-- âœ… Modal xÃ¡c nháº­n Ä‘Äƒng xuáº¥t -->
  <div id="modal-logout" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 400px; position: relative;">
      <span class="close" onclick="closeModalLogout()" style="position: absolute; top: 10px; right: 10px; font-size: 24px; cursor: pointer;">&times;</span>
      <h3>ÄÄƒng xuáº¥t</h3>
      <p>Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n Ä‘Äƒng xuáº¥t?</p>
      <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 1rem;">
        <button class="btn btn-secondary" onclick="closeModalLogout()">Huá»·</button>
        <button id="modal-logout-confirm" class="btn btn-red">ÄÄƒng xuáº¥t</button>
      </div>
    </div>
  </div>

  <!-- âœ… Modal xÃ¡c nháº­n há»§y lá»›p -->
  <div id="confirmUnenrollModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 400px; position: relative;">
      <span class="close" onclick="closeUnenrollModal()" style="position: absolute; top: 10px; right: 10px; font-size: 20px; cursor: pointer;">&times;</span>
      <h3 style="display: flex; align-items: center; gap: 0.5rem;">
      <span style="font-weight: bold;">Há»§y Ä‘Äƒng kÃ½ lá»›p</span>
      </h3>
      <p id="unenrollModalText" style="margin-top: 1rem;">Báº¡n cÃ³ cháº¯c muá»‘n há»§y Ä‘Äƒng kÃ½ lá»›p <strong>?</strong></p>
      <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 1.5rem;">
        <button class="btn btn-secondary" onclick="closeUnenrollModal()">Huá»·</button>
        <button class="btn btn-red" onclick="confirmUnenroll()">Há»§y Ä‘Äƒng kÃ½</button>
      </div>
    </div>
  </div>

  <!-- âœ… Modal lá»‹ch sá»­ Ä‘iá»ƒm danh -->
  <div id="attendanceHistoryModal" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close" onclick="closeAttendanceModal()">&times;</span>
      <h3>ğŸ“… Lá»‹ch sá»­ Ä‘iá»ƒm danh</h3>
      <div id="attendance-history-content"></div>
    </div>
  </div>
  
  <script>
    function showSection(section) {
      const user = getCurrentUser();
      const sections = ['dashboard', 'create', 'view', 'info', 'notifications'];
      sections.forEach(id => {
        const el = document.getElementById(`section-${id}`);
        if (el) el.style.display = 'none';
      });

      const target = document.getElementById(`section-${section}`);
      if (target) target.style.display = 'block';

      document.querySelectorAll('.teacher-sidebar a').forEach(a => a.classList.remove('active'));
      const link = document.querySelector(`.teacher-sidebar a[data-section="${section}"]`);
      if (link) link.classList.add('active');

      // Gá»i cÃ¡c chá»©c nÄƒng tÆ°Æ¡ng á»©ng
      if (section === 'info') loadTeacherInfo();
      if (section === 'notifications') {
        loadNotifications(user.user_id, "teacherNotificationList");

        // âœ… Gá»i Ä‘Ã¡nh dáº¥u Ä‘Ã£ Ä‘á»c & cáº­p nháº­t badge
        markAllNotificationsAsRead(user.user_id).then(() => {
          updateNotifBadge(0, "teacherNotifBadge"); // XoÃ¡ sá»‘
        });
      }
    }
  </script>
</body>
</html>
